import asyncio
import logging.config
import os
import dotenv
import logging
from logging import Formatter
import random

from aiogram import Router, Bot, Dispatcher
from aiogram.filters import CommandStart
from aiogram.types import (
    InlineQuery,
    InlineKeyboardMarkup,
    InlineKeyboardButton,
    InlineQueryResultArticle,
    InputTextMessageContent,
    Message
)

dotenv.load_dotenv()

LOGGER_CONFIG = {
    "version": 1,
    "disable_existing_loggers": False,
    "formatters": {
        "console": {
            "()": Formatter,
            "fmt": "%(name)s | %(asctime)s | %(levelname)s | %(message)s"
        }
    },
    "handlers": {
        "console": {
            "level": "DEBUG",
            "class": "logging.StreamHandler",
            "formatter": "console"
        }
    },
    "root": {
        "handlers": ["console"],
        "level": "DEBUG"
    }
}

logger = logging.getLogger("whatpony-bot")
logging.config.dictConfig(LOGGER_CONFIG)

bot = Bot(token=os.getenv("BOT_TOKEN"))
dp = Dispatcher()
router = Router()

keyboard = InlineKeyboardMarkup(
    inline_keyboard=[
        [
            InlineKeyboardButton(text="ะะฐะบะฐั ัั ะฟะพะฝะธ",
                                 switch_inline_query_current_chat="")
        ]
    ]
)

@router.message(CommandStart())
async def start(message: Message):
    await message.answer(
        f"ะัะธะฒะตั, {message.from_user.username}. \nะญัะพั ะฑะพั ะฟะพะทะฒะพะปัะตั ัะทะฝะฐัั ะบะฐะบะฐั ัั ะฟะพะฝััะบะฐ\n\n"
        "ะะฐะฟะธัะธ \"@whatpony_bot\" ััะพะฑั ัะทะฝะฐัั ะบะฐะบะฐั ัั ะฟะพะฝะธ ะธะปะธ ะฝะฐะถะผะธ ะฝะฐ ะบะฝะพะฟะบั \"ะะฐะบะฐั ัั ะฟะพะฝะธ\" ะฝะธะถะต",
        reply_markup=keyboard,
    )

@router.inline_query()
async def inline_handler(inline_query: InlineQuery):
    results = [
        InlineQueryResultArticle(
            id="1",
            title="ะฃะทะฝะฐัั ะบะฐะบะฐั ัั ะฟะพะฝะธ",
            description="ะะฐะถะผะธัะต ััะดะฐ, ััะพะฑั ะพะฟัะตะดะตะปะธัั ะบะฐะบะฐั ะฒั ะฟะพะฝะธ",
            input_message_content=InputTextMessageContent(
                message_text=await get_pony()
            ),
            thumbnail_url="https://derpicdn.net/img/view/2012/1/6/38.png",
            reply_markup=keyboard
        )
    ]
    await inline_query.answer(results,
                              cache_time=1)

async def get_pony():

    _ponies = [
        "๐ ะขะฒะฐะนะปะฐะนั ะกะฟะฐัะบะป - ะะตัะฒัะบ-ะทะฐััะบะฐ, ะบะพัะพััะน ะฟะฐะฝะธะบัะตั ะตัะปะธ ะบะฝะธะณะธ ะฝะต ะฟะพ ะฐะปัะฐะฒะธัั ััะพัั. ๐๐ค",
        "๐ ะะตะนะฝะฑะพั ะะตั - ะฏ ัะฐะผะฐั ะฟะธะทะดะฐัะฐั, ะฑะปััั! (ะฒะตัะฝะพ ะฒัะตะทะฐะตััั ะฒ ะดะตัะตะฒัั) ๐ฅ๐ณ",
        "๐ฆ ะคะปะฐััะตััะฐะน - ะัะตัะตัะต. ะะต ะทะฐัะพะดะธัะต ะฒ ะผะพะน ัะฐัะฐะน! ๐๐ฟ",
        "๐ ะะธะฝะบะธ ะะฐะน - ะะธะฒะพะต ะดะพะบะฐะทะฐัะตะปัััะฒะพ ัะพะณะพ, ััะพ 4-ะต ะธะทะผะตัะตะฝะธะต ัััะตััะฒัะตั ะธ ะพะฝะพ ัะพะทะพะฒะพะต ๐๐",
        "๐ ะญะฟะฟะปะดะถะตะบ - ะัะพ-ัะพ ัะบะฐะทะฐะป ัะปะพะฒะพ \"ัะตะผัั\"? ะฏะฑะปะพัะฝัะน ัะฐะฑ, ะดะพะฑัะพะฒะพะปัะฝะพ ะทะฐััััะฒัะธะน ะฝะฐ ัะตะผะตะนะฝะพะน ะฟะปะฐะฝัะฐัะธะธ ๐ฉโ๐พโ๏ธ",
        "๐ ะััะธัะธ - ะัะธะผะฐะดะพะฝะฝะฐ, ััะธัะฐััะฐั ะบะฐะถะดัะน ัะฒะพะน ะฒะทะดะพั ะฟัะพะธะทะฒะตะดะตะฝะธะตะผ ะธัะบััััะฒะฐ ๐ญโจ",

        "๐ฒ ะกะฟะฐะนะบ - ะกะฐะผะฐั ะปัััะฐั ะฒ ะผะธัะต ะฟัะธะฝัะตััะฐ ๐๐",

        "โ๏ธ ะัะธะฝัะตััะฐ ะกะตะปะตััะธั - ะขะธัะฐะฝ-ะฝะตะฑะพะถะธัะตะปั, 1000 ะปะตั ะฟะพะดะฝะธะผะฐััะฐั ัะพะปะฝัะต ะฟะพ ะฑัะดะธะปัะฝะธะบั ะธ ะพััะตะฒัะฐั ัะฒะพะน ะบััะฟ ะดะพ ะฟะปะฐะฝะตัะฐัะฝัั ัะฐะทะผะตัะพะฒ โฐ๐ฐ",
        "๐ ะัะธะฝัะตััะฐ ะัะฝะฐ - ะญะบั-ัะธัะฐะฝ, ัะผะตะฝะธะฒัะฐั ะบะฐััะตัั ั \"ัะถะฐัะฐััะตะน\" ะฝะฐ \"ะฝะพัะฝัั ะฐะดะผะธะฝะธัััะฐัะธั\" ๐๐",
        "๐ ะัะธะฝัะตััะฐ ะะฐะดัะฝั - ะัะฒัะฐั ะฝัะฝั ะฟัะธะฝัะตััั-ะดััะฝะธะปั ๐ค๐ผ",

        "๐ ะะตัะฟะธ - ะะพัะพะณะปะฐะทะพะต ะฝะตะดะพัะฐะทัะผะตะฝะธะต ๐๐คช",
        "๐ฉ ะขัะธะบัะธ - Grrreat and pooowerful Trixie! (ะะตัะดะฐัะฝะธัะฐ-ัะพะบััะฝะธัะฐ ั ะผะฐะฝะธะตะน ะฒะตะปะธัะธั) ๐ฉ",
        "โ ะะธัะฐ - ะะธะดะธะผะพ ะฑะพะปัะฝะพ ัะดะฐัะธะปะฐัั ะฒ ะดะตัััะฒะต ะธ ัะตะฟะตัั ั ะฝะตะต ัะตัะธั ะฝะฐ ััะบะธ ๐๐ค",
        "๐ฌ ะะพะฝ ะฑะพะฝ - ะะบัะตั ะฑะตะท ะพัะบะฐัะฐ, ัะตัะธะฒัะธะน, ััะพ ะฒ ะผะปะฟ ะฝะต ัะฒะฐัะฐะตั ะถะฐะฝัะฐ ัะพััะธะนัะบะพะณะพ ะฑะพะตะฒะธะบะฐ ๐ฅ๐ญ",
        "๐ป ะะบัะฐะฒะธั - ะะบัะฐะฒั? ะ ั ัะพัั ะปะฐะดั. ะะฐะดั? ๐ต๐ค",
        "๐ง ะะธะฝะธะป ะกะบัััั - ะะพะพะฑัะต-ัะพ ะดะธะดะถะตะน ะะพะฝ-ััะธ. ะััะณะธะผะธ ัะปะพะฒะฐะผะธ, ะณะพัะธัะตัะบะฐั ะฐะฝะธะผะต-ัะปััะฐ ะฒ ัะพะปะฝัะตะทะฐัะธัะฝัั ะพัะบะฐั ะฝะพััั ๐ถ๏ธ๐",

        #"โ๏ธ ะะปะฐัะดัะตะนะทะตั - "
        #"๐ฆ ะคะปะธััะตั - "
        "๐ฅ ะกะฟะธััะฐะนั - ะบะพะผะฐะฝะดะธั ะฟะพะปะบะฐ, ะฝะพั ะดะพ ะฟะพัะพะปะบะฐ โ๏ธ๐",
        
        "โ๏ธ ะะตะบะพัะฐ - ะะพััะฐ ะฝะฐ ะฟะพะฝะพั? ะญัะพ ะฟะพ ะตะต ัะฐััะธ ๐งช๐ฉ",
        "๐ ะะพัะพะปะตะฒะฐ ะัะธะทะฐะปะธั - ะัััะธะน ะถัะบ ะฒ ะญะบะฒะตัััะธะธ ๐",
        "๐จ ะะพัะพะปั ะกะพะผะฑัะฐ - ะขะฐะบ ะผะฝะพะณะพ ะบััะธะป, ััะพ ััะฐะป ะดัะผะพะผ ะพั ะบะฐะปััะฝะฐ ๐ฌ๐ซ๏ธ",
        "๐ฆ ะะธัะบะพัะด - ะัััะต ะกะบะฐะนะฟะฐ ๐",
        "๐ง ะะพัะด ะขะธัะตะบ - ะฃัััะฐะตั ะฑะตะท ะผะฐะณะธะธ, ะบะฐะบ ะดะตะด ะฑะตะท ะฒะธะฐะณัั.๐จ๐ฒ",

        #"ะญะฟะฟะปะฑะปัะผ - ",
        #"ะกะฒะธัะธ ะฑะตะปะปั - ",
        #"ะกะบััะฐะปั - ",

        "๐ ะะฐะนะผะพะฝะด ะขะธะฐัะฐ - ะะพะณะฐัะฐั ััะตัะฒะฐ ั ะบะพัะพะฝะพะน ะฑะพะปััะต, ัะตะผ ะผะพะทะณะธ ๐๐คฎ"
    ]

    _selected_pony = random.choice(_ponies)

    return f"๐ ะขะฒะพั ะฟะพะฝะธ-ะปะธัะฝะพััั: \n{_selected_pony}"

async def main():
    logger.info("Started")
    dp.include_router(router)
    await dp.start_polling(bot)

asyncio.run(main())